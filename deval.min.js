/**
 * Deval.js - HTML5 Javascript template engine
 * 
 * @author fedu
 * @license FREE FOR ALL
 *			But, let me know of any public usage (for fame) or bugs (for shame)
 */
function Deval(e){e||(e={}),this.debug=e.debug?e.debug:!1,this.onLoad=e.onLoad,this.onAjax=e.onAjax,this.onComplete=e.onComplete,this.onError=e.onError,this.prefix=e.prefix?e.prefix:"data-",this.log=function(e){console.log(e)},this.error=function(e){console.error(e)},this._attrs={ignore:this.prefix+"ignore",eval:this.prefix+"eval",loop:this.prefix+"loop",row:this.prefix+"row",value:this.prefix+"value",form:this.prefix+"form",event:this.prefix+"event",ajax:this.prefix+"ajax",params:this.prefix+"params",interval:this.prefix+"interval",limit:this.prefix+"limit",translate:this.prefix+"translate",validate:this.prefix+"validate",callback:this.prefix+"callback",error:this.prefix+"error",debug:this.prefix+"debug"},this.console={log:this.log,error:this.error},this._events={},this._ajaxLoading=0,this._data={},this._objects={},this._storage={},this._templates={},this._formSubmits={},this._dynID="__deval_",this._dynIDNum=0,this._dynHiddenID="__hidden_",this._dynHiddenIDNum=0,this._depth=0}function UrlParser(){this._first=this._last=this._parent="",this._hash={},this.getUrlParams(location.search),this.parsePathParams(location.pathname),this.parseHashParams(location.hash),window.onhashchange=function(){url.parseHashParams(location.hash)}}function getId(e){var t=document.getElementById(e);return t?t:(this.console.error("id() error: id not found: "+e),null)}function runListeners(e){e||(e=window.event);for(var t=0,r=0,a=oListeners[e.type];r<a.aEls.length;r++)if(a.aEls[r]===this){for(t;t<a.aEvts[r].length;t++)a.aEvts[r][t].call(this,e);break}}function getElementStyle(e,t){var r="";if(window.getComputedStyle)r=getComputedStyle(e).getPropertyValue(t);else if(e.currentStyle)try{r=e.currentStyle[t]}catch(a){alert("Browser not supported.")}return r}if(Deval.prototype.parse=function(e){if(void 0!=e&&!e)return this.console.error("Deval.parse says:\n\nThis is not a dom element?\n\n"+e),!1;var t=!1;if("string"==typeof e){if(this.debug&&this.console.log("Deval.parse call for id: "+e),e=document.getElementById(e),void 0!=e&&!e)return this.console.error("Deval.parse says:\n\nElement id not found: "+e),!1;t=!0}e||(e=document.body);for(var r=t?[e]:e.children,a=0;a<r.length;a++){var o=r[a].getAttribute("id");(!o||o&&!this._data[o])&&void 0==r[a].getAttribute(this._attrs.ignore)&&this.parseChild(r[a])&&this.parse(r[a])}return!0},Deval.prototype.parseChild=function(e){if(!e)return!1;var t=e.getAttribute("id");if(t&&this._data[t])return this.debug&&this.console.log("Already parsing: "+t),!1;var r={eval:e.getAttribute(this._attrs.eval),loop:e.getAttribute(this._attrs.loop),form:e.getAttribute(this._attrs.form),value:e.getAttribute(this._attrs.value)};if(r.eval||r.loop){this._depth++,r.row=e.getAttribute(this._attrs.row),r.ajax=e.getAttribute(this._attrs.ajax),r.params=e.getAttribute(this._attrs.params),r.interval=e.getAttribute(this._attrs.interval),r.limit=e.getAttribute(this._attrs.limit),r.event=e.getAttribute(this._attrs.event),r.translate=e.getAttribute(this._attrs.translate),r.validate=e.getAttribute(this._attrs.validate),r.callback=e.getAttribute(this._attrs.callback),r.error=e.getAttribute(this._attrs.error),r.debug=e.getAttribute(this._attrs.debug),t||(this._dynIDNum++,t=this._dynID+this._dynIDNum,e.setAttribute("id",t)),r.id=t,_computedStyle=getElementStyle(e,"display"),r.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:"";var a={eval:r.eval,loop:r.loop},o=!1;for(var s in a){var i=a[s];if(i){r.type=s,r.get="",r.set="";var _=i.split("=");if(void 0==_[1]?r.get=i.trim():(r.set=_.shift().trim(),r.get=_.join("=").trim()),"="==r.get[0]&&(r.set+="=",r.get=r.get.substring(1)),o="eval"==r.type?this.parseEvalAndLoop(r,e,i):!0,o&&(o=this.render(r),!r.form&&!r.value))return o}}}return void 0!=r.form?(this._depth++,r.type="form",r.debug=e.getAttribute(this._attrs.debug),r.params=e.getAttribute(this._attrs.params),r.translate=e.getAttribute(this._attrs.translate),r.validate=e.getAttribute(this._attrs.validate),r.callback=e.getAttribute(this._attrs.callback),r.error=e.getAttribute(this._attrs.error),t||(this._dynIDNum++,t=this._dynID+this._dynIDNum,e.setAttribute("id",t)),r.id=t,_computedStyle=getElementStyle(e,"display"),r.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:"",this.formParse(r)):void 0!=r.value&&(this._depth++,r.debug=e.getAttribute(this._attrs.debug),t||(this._dynIDNum++,t=this._dynID+this._dynIDNum,e.setAttribute("id",t)),r.id=t,_computedStyle=getElementStyle(e,"display"),r.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:"",this.formParseChild(e)),!0},Deval.prototype.parseEvalAndLoop=function(_o,_e,_attr){var _debugmsg="";(this.debug||_o.debug)&&(_debugmsg="Found data-"+_o.type+'="'+_attr+'"');var _operators=new Array("==","!==","=","!","<",">");if(!_o.set||-1==_operators.indexOf(_o.set.slice(-1))&&-1==_operators.indexOf(_o.get[0])){if(!_o.set&&_o.get)try{if(eval("_o.dat = "+_o.get+" ? true : false"),(this.debug||_o.debug)&&this.console.log(_debugmsg+" #2 set/get eval returned: "+_o.dat+(_o.dat?"":" (display:none, ignore)")),_e.style.display=_o.dat?_o.display:"none",!_o.dat)return this._templates[_o.id]||(this._templates[_o.id]=_e.innerHTML),_e.innerHTML="",!1;this._templates[_o.id]&&(_e.innerHTML=this._templates[_o.id])}catch(_error){return this.console.error("Deval.parseEvalAndLoop straight if eval says: \n\n"+_error+"\n\ndata-"+_o.type+'="'+_attr+'"'),!1}else if(_o.set&&"this."==_o.set.substring(0,5))try{_attr=_attr.replace("this.","_e."),eval(_attr),(this.debug||_o.debug)&&this.console.log(_debugmsg+" #3 dom ref (this) eval ok: "+_attr)}catch(_error){return this.console.error("Deval.parseEvalAndLoop this match eval says: \n\n"+_error+"\n\ndata-"+_o.type+'="'+_attr+'"'),!1}}else try{if(eval("_o.dat = "+_attr),(this.debug||_o.debug)&&this.console.log(_debugmsg+" #1 comparison eval returned: "+_o.dat+(_o.dat?"":" (display:none, ignore)")),_e.style.display=_o.dat?_o.display:"none",!_o.dat)return this._templates[_o.id]||(this._templates[_o.id]=_e.innerHTML),_e.innerHTML="",!1;this._templates[_o.id]&&(_e.innerHTML=this._templates[_o.id])}catch(_error){return this.console.error("Deval.parseEvalAndLoop eval says: \n\n"+_error+"\n\ndata-"+_o.type+'="'+_attr+'"'),!1}return!0},Deval.prototype.render=function(_o){var _e;if("string"==typeof _o)return _e=document.getElementById(_o),_e?this.parseChild(_e):(this.console.error("Deval.render says:\n\nUnknown id: \n\n"+_o),!1);var _err="";if(!_o.id||void 0==_o.set||void 0==_o.dat&&!_o.get&&!_o.url&&"form"!=_o.type){try{_err=JSON.stringify(_o)}catch(errori){}return this.console.error("Deval.render says:\n\nInsufficent params!\n\n"+_err),!1}if(_e=document.getElementById(_o.id),!_e){try{_err=JSON.stringify(_o)}catch(_errori){}return this.console.error("Deval.render says:\n\nElement id not found: "+_o.id+"\n\n"+_err),!1}if(this._objects[_o.id]&&this._objects[_o.id].template&&(_o.template=this._objects[_o.id].template,_o.display=this._objects[_o.id].display?this._objects[_o.id].display:""),void 0==_o.display&&(_computedStyle=getElementStyle(_e,"display"),_o.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:""),_o.type=_o.type?_o.type:"eval",!_o.updateCallback&&this._objects[_o.id]&&this._objects[_o.id].updateCallback&&(_o.updateCallback=this._objects[_o.id].updateCallback),(this.debug||_o.debug)&&(this.console.log("---------------------------------------------------------------"),this.console.log("Parsing "+_o.type+": "+(_o.set?_o.set+"=":"")+(_o.get?_o.get:_o.url?_o.url:_o.dat?_o.dat:"")+(_o.interval?" (interval: "+_o.interval+")":""))),_o.dom=_e,void 0==_o.dat){var _ajaxGetCall=_o.get&&"ajax:"==_o.get.substring(0,5)?!0:!1;if(_o.url||_ajaxGetCall){if(_ajaxGetCall){var _ajaxParams=_o.get.split(":");if(_ajaxParams.shift(),_o.ajax=!0,_o.params=_o.params?_o.params:_o.dom.getAttribute(this._attrs.params),!_o.translate&&_ajaxParams[1]){var _trans=_ajaxParams[0];switch(_trans){case"json":case"xml":case"tags":_ajaxParams.shift(),_o.translate=_trans}}_o.url=_ajaxParams.join(":")}return _o.get="",this._objects[_o.id]=_o,_o.parser=this,this.ajaxCall(_o),!1}if(void 0==_o.dat&&_o.get)try{if(_o.set?eval("_o.dat = "+_o.set+"="+_o.get):eval("_o.dat = "+_o.get),_e.style.display=_o.dat?_o.display:"none",!_o.dat)return _e.innerHTML="",!1}catch(error){var err="";try{delete _o.dom,err=JSON.stringify(_o)}catch(errori){}return(this.debug||_o.debug)&&this.console.error("Deval.render get/set eval says: \n\n"+error+"\n\n"+err),!1}}else if(_o.set&&_o.dat)try{eval(_o.set+"=_o.dat")}catch(error){var erri="";try{delete _o.dom,erri=JSON.stringify(_o)}catch(errori){}return this.console.error("Deval.render set eval says: \n\n"+error+"\n\n"+erri),!1}if(void 0==_o.dat)return!1;var _debugmsg="";(this.debug||_o.debug)&&(_debugmsg="Rendering "+_o.type+": "+(_o.set?_o.set+"=":"")+_o.get+" ("+(_o.dat?typeof _o.dat:_o.get)+") ("+_o.id+")");var _template=_o.template?_o.template:_o.dom.innerHTML;switch(_o.template||(_o.template=_template),this._objects[_o.id]||(this._objects[_o.id]=_o),_o.type){default:(this.debug||_o.debug)&&this.console.log(_debugmsg);break;case"eval":(this.debug||_o.debug)&&this.console.log(_debugmsg),_o.template=this.renderType(_o),_o.dom.innerHTML=_o.template,_o.template=_template,_o.dom.children[0]&&(_o.set&&eval(_o.set+"=_o.dat"),this.parse(_o.dom));break;case"loop":var _loopedTemplate="",_count=0,_start=0,_length=_o.dat.length,_limitcall=_o.limit;if(_o.limit)if(parseInt(_o.limit)==_o.limit)_o.limit=parseInt(_o.limit);else if(_o.limit.match(",")){var _tmp=_o.limit.split(",");if(_tmp[1])try{eval("_start = "+_tmp[0]),eval("_o.limit = "+_tmp[1]),_start=parseInt(_start),_o.limit=parseInt(_o.limit)}catch(_erri){return this.console.error("Deval.render limit eval says: "+_erri+" (fix your limit methods/variables!)"),!1}}else try{eval("_o.limit = "+_o.limit),_o.limit=parseInt(_o.limit)}catch(_erri){return this.console.error("Deval.render limit eval says: "+_erri+" (fix your limit method/variable!)"),!1}(this.debug||_o.debug)&&_o.limit&&this.console.log("Limiting rendering loop with: "+(_start?_start+", "+_o.limit:_o.limit)+" ("+this._attrs.limit+'="'+_limitcall+'")');var _i,_olength;if(void 0==_length){_length=Object.keys(_o.dat).length,(this.debug||_o.debug)&&this.console.log(_debugmsg+"("+_length+")");for(_i in _o.dat){if(_o.limit&&_count>=_o.limit)break;if(_count>=_start){if(_o.row){(this.debug||_o.debug)&&this.console.log("Formatting loop row: "+_o.set+"["+_i+"]="+_o.row+"("+_o.set+"["+_i+"])");try{eval("_o.dat[_i]="+_o.row+"(_o.dat[_i])")}catch(errorr){return this.console.error("Deval.render loop row says: \n\n"+errorr+" with "+_o.row),!1}}_olength=_o.dat[_i]?_o.dat[_i].length:0,void 0==_olength&&"object"==typeof _o.dat[_i]&&(_olength=Object.keys(_o.dat[_i]).length),_o.template=_template,_o.template=_o.template.replace(new RegExp("\\["+_o.set+".key\\(\\)\\]","g"),_i),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".num\\(\\)\\]","g"),_count+1),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".count\\(\\)\\]","g"),_olength),_o.dom.innerHTML=this.renderChild(_o,_i),_o.dom.children[0]&&(_o.set&&eval(_o.set+"=_o.dat[_i]"),this.parse(_o.dom)),_loopedTemplate+=_o.dom.innerHTML}_count++}}else for((this.debug||_o.debug)&&this.console.log(_debugmsg+"("+_length+")"),_i=_start;_length>_i&&!(_o.limit&&_count>=_o.limit);_i++){if(_count>=_start){if(_o.row){(this.debug||_o.debug)&&this.console.log("Formatting loop row: "+_o.set+"["+_i+"]="+_o.row+"("+_o.set+"["+_i+"])");try{eval("_o.dat[_i]="+_o.row+"(_o.dat[_i])")}catch(errorr){return this.console.error("Deval.render loop row says: \n\n"+errorr+" with "+_o.row),!1}}_olength=_o.dat[_i]?_o.dat[_i].length:0,void 0==_olength&&"object"==typeof _o.dat[_i]&&(_olength=Object.keys(_o.dat[_i]).length),_o.template=_template,_o.template=_o.template.replace(new RegExp("\\["+_o.set+".key\\(\\)\\]","g"),_i),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".num\\(\\)\\]","g"),_count+1),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".count\\(\\)\\]","g"),_olength),_o.dom.innerHTML=this.renderChild(_o,_i),_o.dom.children[0]&&(_o.set&&eval(_o.set+"=_o.dat[_i]"),this.parse(_o.dom)),_loopedTemplate+=_o.dom.innerHTML}_count++}_o.dom.innerHTML=_loopedTemplate,_o.template=_template}if(this._data[_o.id]=!1,_o.interval&&(!_o.ajax||_o.ajax&&_o.dat)&&(delete _o.dom,delete _o.dat,delete _o.parser,setTimeout("deval.render("+JSON.stringify(_o)+");",parseInt(_o.interval))),_o.event)try{this.addEventListener(_o.event,_o.id)}catch(_eventErr){this.console.error("Deval.render event says: "+_eventErr)}if(_e.style.display="",_o.callback&&_o.dat)switch(delete _o.dom,delete _o.parser,typeof _o.callback){case"string":try{(this.debug||_o.debug)&&this.console.log("Callback: "+_o.callback+" (id:"+_o.id+")"),eval(_o.callback+"(_o)")}catch(_error){this.console.error("Deval.render callback says: "+_error)}break;default:(this.debug||_o.debug)&&this.console.log("Callback: function (id:"+_o.id+")"),_o.callback(_o)}if(_o.updateCallback)switch(delete _o.dom,delete _o.parser,typeof _o.updateCallback){case"string":try{eval(_o.updateCallback+"(_o)")}catch(_error){this.console.error("Deval.render update-callback says: "+_error)}break;default:_o.updateCallback(_o)}return!1},Deval.prototype.addEventListener=function(e,t){return this._events[e]&&this._events[e][t]?this._events[e][t]:(this.debug&&this.console.log('Listening on event "'+e+'" for id: '+t),window.addEventListener(e,function(e){this.debug&&this.console.log("dispatchEvent: "+e.detail),this.update(e.detail)}.bind(this)),this._events[e]||(this._events[e]={}),this._events[e][t]=new CustomEvent(e,{detail:t}),this._events[e][t])},Deval.prototype.removeEventListener=function(e,t){if(!this._events[e]||!this._events[e][t])return!0;if(this.debug&&(t?this.console.log('Removing listener "'+e+'" for id: '+t):this.console.log('Removing listener "'+e)),!t){for(var r in this.events[e])window.removeEventListener(e,this.events[e][t]);return!0}return window.removeEventListener(e,this._events[e][t])},Deval.prototype.dispatchEvent=function(e,t){if(!this._events[e]||t&&!this._events[e][t])return this.console.error('Deval.js dispatchEvent says: Unknown event "'+e+'", use Deval.addEventListener to create it.');try{if(this.debug&&(t?this.console.log('Event "'+e+'" for id: '+t):this.console.log('Event "'+e)),t)return window.dispatchEvent(this._events[e][t]);for(var r in this._events[e])window.dispatchEvent(this._events[e][r]);return!0}catch(a){this.console.error("Deval.js dispatchEvent says: "+a)}},Deval.prototype.event=function(e,t){return this._events[e]?this.dispatchEvent(e):this.addEventListener(e,t)},Deval.prototype.renderChild=function(e,t){return this.renderType({dom:e.dom,id:e.id,set:e.set,get:e.get,dat:e.dat[t],url:e.url,callback:e.callback,template:e.template,limit:e.limit,display:e.display,debug:e.debug})},Deval.prototype.renderType=function(e){switch(e.dat.constructor){case Object:case Array:e=this.renderSingle(e),e=this.renderMulti(e);break;default:e=this.renderSingle(e)}return e.template},Deval.prototype.renderSingle=function(e){if(!e.set)return e;try{var t=e.template.replace(new RegExp("\\["+e.set+"\\]","g"),e.dat);e.template=t}catch(r){var a="";try{delete e.dom,a=JSON.stringify(e)}catch(o){}return this.console.error("Deval.render get says:\n\n"+r+"\n\n"+a),e}return e},Deval.prototype.renderMulti=function(_o){if(!_o.set)return _o.dom.style.display=_o.dat?_o.display:"none",_o;var _tmplate=_o.template;_brackets=_tmplate.match(new RegExp("\\[[^"+_o.set+".]([^.].*?)\\]","g"));var _i;if(_brackets)for(_i=0;_i<_brackets.length;_i++)_tmplate=_tmplate.replace(_brackets[_i],_brackets[_i].replace(new RegExp("\\]","g"),"%!}"));if(_brackets=_tmplate.match(new RegExp("\\[("+_o.set+".[^.].*?)\\]","g")),!_brackets)return _o;var _template=_o.template;for(_i=0;_i<_brackets.length;_i++){_brackets[_i]=_brackets[_i].replace(new RegExp("%!}","g"),"]");var _match=_brackets[_i].substring(1,_brackets[_i].length-1);try{eval(_o.set+"=_o.dat")}catch(_error){var _err="";try{delete _o.dom,_err=JSON.stringify(_o)}catch(errori){}return this.console.error("Deval.render dat eval says:\n\n"+_error+"\n\n"+_err),_o}var _replace="";try{eval("_replace ="+_match)}catch(_error){(this.debug||_o.debug)&&this.console.error("Deval.render array/object says:\n\n"+_error+"\n\n"+_brackets[_i]+"\n\n"),_replace=""}void 0==_replace&&(_replace=""),_template=_template.replace(new RegExp(_brackets[_i].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),_replace)}return _o.template=_template,_o},Deval.prototype.update=function(_id,_updateCallback){if(!this._objects[_id]){var _e=document.getElementById(_id);return _e?this.parseChild(_e):(this.console.error("Deval.update id not found:\n\n"+_id),!1)}delete this._objects[_id].dom,delete this._objects[_id].dat,delete this._objects[_id].parser,this._data[_id]=!1,_updateCallback&&(this._objects[_id].updateCallback=_updateCallback),this.debug&&this.console.log("Deval.update call for id: "+_id),eval("deval.render("+JSON.stringify(this._objects[_id])+");")},Deval.prototype.store=function(e){return this._data[e]?!1:(this._data[e]=!0,!0)},Deval.prototype.ajaxCall=function(_o,_data){var self=this;_o.ajaxCall=function(_ref){var _ajaxRequest;try{_ajaxRequest=new XMLHttpRequest}catch(_e){try{_ajaxRequest=new ActiveXObject("Msxml2.XMLHTTP")}catch(_e){try{_ajaxRequest=new ActiveXObject("Microsoft.XMLHTTP")}catch(_e){return _ref.ajax="error",_ref.parser&&_ref.parser.ajaxParse(_ref),self.console.error("Deval.ajaxCall says:\n\nNo Ajax support in your browser?"),!1}}}_ajaxRequest.onerror=function(e){_ref.ajax="error",_ref.parser&&_ref.parser.ajaxParse(_ref,"Could not access the URL")},_ajaxRequest.onreadystatechange=function(){4==_ajaxRequest.readyState&&(200==_ajaxRequest.status||304==_ajaxRequest.status?(_ref.dat=_ajaxRequest.responseText,_ref.ajax="ok",_ref.parser&&_ref.parser.ajaxParse(_ref)):_ajaxRequest.status&&(_ref.ajax="error",_ref.parser&&_ref.parser.ajaxParse(_ref,"URL response status was: "+_ajaxRequest.status)))};var _url=_ref.url;if(_ref.params){var _check=void 0,_urlParamsValidated=[];if(-1===_ref.params.indexOf("="))try{switch(eval("_check = "+_ref.params),_check.constructor){case Array:for(var _a=0;_a<_check.length;_a++)(_check.constructor!==Array||_check.constructor!==Object)&&_urlParamsValidated.push(_a+"="+_check[_a]);break;case Object:for(var _b in _check)(_check.constructor!==Array||_check.constructor!==Object)&&_urlParamsValidated.push(_b+"="+_check[_b]);break;default:_urlParamsValidated.push(_check)}}catch(_err){self.debug&&self.console.log(_ref.params+": "+_err),_check=void 0}if(void 0==_check)for(var _params=_ref.params.split("&"),_i=0;_i<_params.length;_i++){var _vals=_params[_i].split("=");if(_vals[1])try{eval("_check = "+_vals[1])}catch(_err){self.console.error("Deval.ajaxCall data-params:\n\n"+_err)}if(void 0!=_check)switch(_check.constructor){case Array:for(var _c=0;_c<_check.length;_c++)_urlParamsValidated.push(_vals[0]+"["+_c+"]="+_check[_c]);break;case Object:for(var _d in _check)_urlParamsValidated.push(_vals[0]+"["+_d+"]="+_check[_d]);break;default:_urlParamsValidated.push(_vals[0]+"="+_check)}else _urlParamsValidated.push(_vals[0])}_urlParamsValidated=_urlParamsValidated.join("&"),_url+=-1==_ref.url.indexOf("?")?"?":"&",_url+=_urlParamsValidated}_data?(_ajaxRequest.open(_ref.method?_ref.method:"POST",_url,!0),_ref.enctype||(_ref.enctype="application/x-www-form-urlencoded"),_ajaxRequest.setRequestHeader("Content-type",_ref.enctype),_ajaxRequest.send(_data)):(_ajaxRequest.open(_ref.method?_ref.method:"GET",_url,!0),_ajaxRequest.send(null)),_ref.ajax="loading",_ref.parser&&_ref.parser.ajaxParse(_ref)},self.ajaxState(1),_o.ajax="init",_o.ajaxCall(_o,_data)},Deval.prototype.ajaxState=function(e){this._ajaxLoading+=e,!this._ajaxLoading&&this.onAjax?this.onAjax():this.onLoad&&this.onLoad()},Deval.prototype.ajaxParse=function(_o,_errormsg){var init=!1,error=!1,loading=!1,ok=!1;switch(_o.ajax){case"init":init=!0;break;case"error":this.ajaxState(-1),error=!0;break;case"loading":loading=!0;break;case"ok":if(ok=!0,this.ajaxState(-1),_o.ajaxSuccess=!0,_o.dat&&_o.translate)switch(_o.translate){case"json":try{_o.dat=JSON.parse(_o.dat)}catch(_e){var _err="";try{delete _o.dom,delete _o.parser,_err=JSON.stringify(_o)}catch(_errori){}this.console.error("Deval.ajaxParse JSON.parse says:\n\n"+_e+"\n\n"+_err),error=!0}break;case"xml":try{if(window.DOMParser){var _parser=new DOMParser;_o.dat=_parser.parseFromString(_o.dat,"text/xml")}else{var _xmlDoc=new ActiveXObject("Microsoft.XMLDOM");_xmlDoc.async=!1,_xmlDoc.loadXML(_o.dat),_o.dat=_xmlDoc}}catch(_e){var _erri="";try{delete _o.dom,delete _o.parser,_erri=JSON.stringify(_o)}catch(_errori){}this.console.error("Deval.ajaxParse XML parser says:\n\n"+_e+"\n\n"+_erri),error=!0}break;case"tags":_o.dat=_o.dat.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");break;default:switch(typeof _o.translate){case"string":try{eval("_o.dat = "+_o.translate+"(_o.dat);"),(_o.parser&&_o.parser.debug||_o.debug)&&this.console.log("Deval.ajaxParse says:\n\nTranslation ok: "+_o.translate)}catch(_error){this.console.error("Deval.ajaxParse says:\n\nTranslation error with: "+_o.translate+"\n\n"+_error)}break;default:_o.dat=_o.translate(_o.dat)}}}if("form"==_o.type)return error&&this.console.error(_errormsg),_o.errormsg=_errormsg,this.formParse(_o);var _e=_o.dom?_o.dom:document.getElementById(_o.id);if(!_e){var _erra="";try{delete _o.dom,delete _o.parser,_erra=JSON.stringify(_o)}catch(_errori){}return this.console.error("Deval.ajaxParse says:\n\nElement id not found: "+_o.id+"\n\n"+_erra),!1}var _computedStyle=getElementStyle(_e,"display");"none"==_computedStyle&&(_e.style.display="");for(var _children=_e.getElementsByTagName("*"),_i=0;_i<_children.length;_i++)if(_children[_i]){var _attr=_children[_i].getAttribute(this._attrs.ajax);if(_attr){var _check=!1;try{eval("_check = "+_attr)}catch(_e){var _errb="";try{delete _o.dom,delete _o.parser,_errb=JSON.stringify(_o)}catch(_errori){}return this.console.error("Deval.ajaxParse data-ajax says:\n\n"+_e+"\n\n"+_errb),!1}_children[_i].style.display=_check||"ok"==_attr&&_o.ajaxSuccess?_o.display:"none"}}ok?((_o.parser&&_o.parser.debug||_o.debug)&&this.console.log("Ajax finished: "+_o.url+" (id:"+_o.id+")"),this.render(_o),this.onComplete&&setTimeout(this.onComplete(_o.id),1)):error?((_o.parser&&_o.parser.debug||_o.debug)&&this.console.error("Ajax ERROR "+_o.id+": \n\n"+(_errormsg?_errormsg+"\n\n":"")+"data-"+_o.type+'="'+_o.set+" = "+_o.url+'"'),_o.interval&&(delete _o.dom,delete _o.dat,setTimeout("deval.render("+JSON.stringify(_o)+");",parseInt(_o.interval)))):(_o.parser&&_o.parser.debug||_o.debug)&&this.console.log("Ajax "+(_o.method?_o.method:"GET")+": data-"+_o.type+'="'+_o.set+" = "+_o.url+'" (id:'+_o.id+")"),this._data[_o.id]=!1},Deval.prototype.formParse=function(_o){var _e=document.getElementById(_o.id);if(!_e){var _err="",_id=_o.id;try{delete _o.dom,delete _o.parser,delete _o.id,_err=JSON.stringify(_o)}catch(_errori){_err+="\n\n"+_errori}return this.console.error("Deval.formParse says:\n\nElement id not found: "+_id+"\n\n"+_err),!1}_o.ajax||(_o.ajax="init");var init="init"==_o.ajax,error="error"==_o.ajax,loading="loading"==_o.ajax,ok="ok"==_o.ajax;if(void 0==_o.display){var _computedStyle=getElementStyle(_e,"display");"none"==_computedStyle&&(_e.style.display="")}_o.action=_e.action,_o.method=_e.method,this._formSubmits[_o.id]||(_o.template=_e.innerHTML,this._formSubmits[_o.id]=_o),_e.onsubmit||(_e.onsubmit=function(e){return deval.formSubmit(this,e)});for(var _children=_e.getElementsByTagName("*"),_attr,_i=0;_i<_children.length;_i++)if(_children[_i])if(_attr=_e.getAttribute(this._attrs.ajax)){var _check=!1;try{eval("_check = "+_attr)}catch(_er){var _errd="";try{delete _o.dom,delete _o.parser,_errd=JSON.stringify(_o)}catch(_errori){}return this.console.error("Deval.formParse data-ajax says:\n\n"+_er+"\n\n"+_errd),!1}_e.style.display=_check?_o.display:"none"}else if(init&&_o.validate&&!_e.notyetvalidated)switch(_e.notyetvalidated=!0,_e.type){default:_e.addEventListener("keyup",function(){try{eval('deval.formChange("'+_o.id+'", "'+_o.validate+'")')}catch(_error){this.console.error("Error! data-validate says:\n\n"+_error)}});break;case"radio":case"checkbox":case"select-one":case"select-multiple":_e.addEventListener("change",function(){try{eval('deval.formChange("'+_o.id+'", "'+_o.validate+'")')}catch(_error){this.console.error("Error! data-validate says:\n\n"+_error)}})}ok&&_o.dat?(_o.callback=_e.getAttribute(this._attrs.callback),this.formCallback(_o)):_o.errormsg&&(_o.callback=_e.getAttribute(this._attrs.callback),this.formCallback(_o),_o.errormsg="")},Deval.prototype.formCallback=function(_o){if(_o.callback)switch(typeof _o.callback){case"string":try{eval(_o.callback+"(_o.dat, _o.errormsg)")}catch(_error){this.console.log("FormParse callback(string) error with: "+_o.formCallback+"\n\n"+_error)}break;case"function":try{_o.callback(_o.dat,_o.errormsg)}catch(_error){this.console.log("FormParse callback error with: "+_o.callback+"(data)\n\n"+_error)}}if(_o.formCallback)switch(typeof _o.formCallback){case"string":try{eval(_o.formCallback+"(_o.dat, _o.errormsg)")}catch(_error){this.console.log("FormParse formCallback(string) error with: "+_o.formCallback+"\n\n"+_error)}break;case"function":try{_o.formCallback(_o.dat,_o.errormsg)}catch(_error){this.console.log("FormParse formCallback error with: "+_o.formCallback+"(data)\n\n"+_error)}}},Deval.prototype.formParseChild=function(_e){var _attr=_e.getAttribute("name"),_stored=void 0;this.urlParamsToForm&&(_stored=url[_attr]);var _tmp,c;if(void 0==_stored){var _defaultValue=_e.getAttribute(this._attrs.value);if(void 0!=_defaultValue&&_defaultValue)try{eval("_stored = "+_defaultValue)}catch(_error){this.console.error("Error! data-value says:\n\n"+_error)}}if(void 0!=_stored)switch(_e.type){case"radio":case"checkbox":_e.checked=!1,_stored&&(_stored="false"!=_stored&&_stored!==!1&&""!==_stored?!0:!1,_stored&&(_e.checked=!0));break;case"select-one":for(_c=0;_c<_e.options.length;_c++)_e.options[_c].selected=!1,_e.options[_c].value==_stored&&(_e.options[_c].selected=!0);break;case"select-multiple":for(_c=0;_c<_e.options.length;_c++)if(_e.options[_c].selected=!1,_tmp=_stored,"string"==typeof _stored&&_stored.match(",")&&(_tmp=_stored.split(",")),_tmp.constructor===Object||_tmp.constructor===Array)for(var _d=0;_d<_tmp.length;_d++)_tmp[_d]==_e.options[_c].value&&(_e.options[_c].selected=!0);else _tmp==_e.options[_c].value&&(_e.options[_c].selected=!0);break;default:_e.value=_stored}return!0},Deval.prototype.formChange=function(_formid,_method){var _e=document.getElementById(_formid);if(!_e)return this.console.error("Deval.formChange says:\n\nElement id not found: "+_formid),!1;var _data=this.formValues(_e,!0);if(void 0!=_data)try{return eval("var _check="+_method+"(_data)"),_check}catch(_error){this.console.error('Deval.formChange data-change="'+_method+'" eval says:\n\nError calling: '+_method+"(data)\n\n"+_error)}},Deval.prototype.formSubmit=function(_e,_formCallback){var _o=this._formSubmits[_e.getAttribute("id")];if(_o.validate){var checkIfBoolean=null;try{eval('checkIfBoolean = deval.formChange("'+_o.id+'", "'+_o.validate+'")')}catch(_err){this.console.error('Deval.formSubmit data-validate="'+_o.validate+'" eval says:\n\nError calling: '+_o.validate+"(data)\n\n"+_err)}if(checkIfBoolean===!1)return checkIfBoolean}if(_o.formCallback=_formCallback,_o.method=_o.method?_o.method:"post",_o.action)try{_o.url=_o.action;var _data=this.formValues(_e);if(_o.parser=this,_o.ajax="loading",this.formParse(_o),_o.translate=_o.translate?_o.translate:_e.getAttribute(this._attrs.translate),_e.getAttribute("target"))return _formCallback&&(delete _o.dom,delete _o.parser,setTimeout(_formCallback(JSON.stringify(_o)),200)),!0;this.console.log("Deval.formSubmit ajaxCall "+_o.method+" "+_o.action),this.ajaxCall(_o,_data)}catch(_error){var _err="";try{delete _o.dom,delete _o.parser,_err=JSON.stringify(_o)}catch(_errori){}this.console.error("Deval.formSubmit ajax "+_o.method+" says:\n\n"+_error+"\n\n"+_err),_o.ajax="error",this.formParse(_o)}return!1},Deval.prototype.formValues=function(e,t){var r=e.getElementsByTagName("*"),a=e.getAttribute("id"),o=e.getAttribute("enctype");if(FormData&&"multipart/form-data"==o){var s=new FormData(e);return s}_formData=null;for(var i=[],_={},n=0;n<r.length;n++)if(r[n]){var l=r[n].getAttribute("name");if(l){var d,c;switch(r[n].type){case"radio":case"checkbox":c=r[n].value?r[n].value:!0,c=r[n].checked?c:"",t?_[l]=c:_formData?_formData.append(l,c):i.push(l+"="+c);break;case"select-one":case"select-multiple":for(d=0;d<r[n].options.length;d++)r[n].options[d].selected&&(c=r[n].options[d].value,t?_[l]=c:_formData?_formData.append(l,c):i.push(l+"="+c));break;case"file":for(d=0;d<r[n].files.length;d++)if(r[n].files[d].name)if(t)_[l]=r[n].files[d].name;else{if(!_formData){var h=a+"ajax_iframe",p=document.getElementById(h);if(!p){var u=document.createElement("iframe");u.name=h,u.setAttribute("id",h),e.setAttribute("target",h)}throw new TypeError("Your browser does not support AJAX file uploading.")}_formData.append(l,r[n].files[d])}break;default:c=r[n].value,t?_[l]=c:_formData?_formData.append(l,c):i.push(l+"="+c)}}}return t?_:_formData?_formData:i.join("&")},Deval.prototype.formStorage=function(e){var t="";switch(e.type){case"radio":case"checkbox":t=sessionStorage[e.name]=e.checked?e.value:"";break;case"select-one":t=sessionStorage[e.name]=e.value;break;case"select-multiple":for(var r=[],a=0;a<e.options.length;a++)e.options[a].selected&&r.push(e.options[a].value);t=sessionStorage[e.name]=r;break;default:t=sessionStorage[e.name]=e.value}if(this._storage[e.name]=t,this.debug&&this.console.log(e.name+": "+t),this.onStorage)try{this.onStorage(this._storage)}catch(o){return this.console.error("Deval.formStorage callback says:\n\n"+o+"\n\n"+this.onStorage),!1}},Deval.prototype.clearStorage=function(){for(var e in this._storage)this.debug&&this.console.log("Deleted: "+e+" = "+this._storage[e]),delete sessionStorage[e];if(this._storage={},this.debug&&this.console.log("Storage cleared."),this.onStorage)try{this.onStorage(this._storage)}catch(t){return this.console.error("Deval.formStorage callback says:\n\n"+t+"\n\n"+this.onStorage),!1}},UrlParser.prototype.getUrlParams=function(e){var t=/(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g,r={},a=function(e){return decodeURIComponent(e.replace(/\+/g," "))};for("undefined"==typeof e&&(e=document.location.href);r=t.exec(e);)this[a(r[1])]?"object"!=typeof params[a(r[1])]?this[a(r[1])]=new Array(this[a(r[1])],a(r[2])):this[a(r[1])].push(a(r[2])):this[a(r[1])]=a(r[2])},UrlParser.prototype.parsePathParams=function(e){for(var t=e.split("/"),r=t.length,a=0;r>a;a++)t[a]&&(a==r-1&&(this._parent=this._last?this._last:""),1==a&&(this._first=t[a]),this._last=this[a]=t[a])},UrlParser.prototype.parseHashParams=function(e){var t=e.replace("#","");if(t){var r=t.split("&");for(var a in r){var o=r[a].split("=");this._hash[o[0]]=o[1]}}},"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on a non-object");var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}),!Element.prototype.addEventListener){var oListeners={};Element.prototype.addEventListener=function(e,t){if(oListeners.hasOwnProperty(e)){for(var r=oListeners[e],a=-1,o=0;o<r.aEls.length;o++)if(r.aEls[o]===this){a=o;break}if(-1===a)r.aEls.push(this),r.aEvts.push([t]),this["on"+e]=runListeners;else{var s=r.aEvts[a];this["on"+e]!==runListeners&&(s.splice(0),this["on"+e]=runListeners);for(var i=0;i<s.length;i++)if(s[i]===t)return;s.push(t)}}else oListeners[e]={aEls:[this],aEvts:[[t]]},this["on"+e]=runListeners},Element.prototype.removeEventListener=function(e,t){if(oListeners.hasOwnProperty(e)){for(var r=oListeners[e],a=-1,o=0;o<r.aEls.length;o++)if(r.aEls[o]===this){
a=o;break}if(-1!==a)for(var s=0,i=r.aEvts[a];s<i.length;s++)i[s]===t&&i.splice(s,1)}}}!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}return"function"==typeof window.CustomEvent?!1:(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}(),console||(console={log:function(e){},error:function(e){}});var url=new UrlParser,deval=new Deval;