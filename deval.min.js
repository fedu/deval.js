/**
 * Deval.js - HTML5 Javascript template engine
 *
 * @author fedu
 * @license FREE FOR ALL
 *			But, let me know of any public usage (for fame) or bugs (for shame)
 */
function Deval(a){a||(a={}),this.debug=!!a.debug&&a.debug,this.onLoad=a.onLoad,this.onAjax=a.onAjax,this.onComplete=a.onComplete,this.onError=a.onError,this.prefix=a.prefix?a.prefix:"data-",this.log=function(a){console.log(a)},this.error=function(a){console.error(a)},this._attrs={ignore:this.prefix+"ignore",eval:this.prefix+"eval",loop:this.prefix+"loop",row:this.prefix+"row",value:this.prefix+"value",form:this.prefix+"form",event:this.prefix+"event",ajax:this.prefix+"ajax",params:this.prefix+"params",interval:this.prefix+"interval",limit:this.prefix+"limit",translate:this.prefix+"translate",validate:this.prefix+"validate",callback:this.prefix+"callback",error:this.prefix+"error",debug:this.prefix+"debug"},this.console={log:this.log,error:this.error},this._events={},this._ajaxLoading=0,this._data={},this._objects={},this._storage={},this._templates={},this._formSubmits={},this._dynID="__deval_",this._dynIDNum=0,this._dynHiddenID="__hidden_",this._dynHiddenIDNum=0,this._depth=0}function UrlParser(){this._first=this._last=this._parent="",this._hash={},this.getUrlParams(location.search),this.parsePathParams(location.pathname),this.parseHashParams(location.hash),window.onhashchange=function(){url.parseHashParams(location.hash)}}function getId(a){var b=document.getElementById(a);return b?b:(this.console.error("id() error: id not found: "+a),null)}function runListeners(a){a||(a=window.event);for(var b=0,c=0,d=oListeners[a.type];c<d.aEls.length;c++)if(d.aEls[c]===this){for(b;b<d.aEvts[c].length;b++)d.aEvts[c][b].call(this,a);break}}function getElementStyle(a,b){var c="";if(window.getComputedStyle)c=getComputedStyle(a).getPropertyValue(b);else if(a.currentStyle)try{c=a.currentStyle[b]}catch(a){alert("Browser not supported.")}return c}if(Deval.prototype.parse=function(a){if(void 0!=a&&!a)return this.console.error("Deval.parse says:\n\nThis is not a dom element?\n\n"+a),!1;var b=!1;if("string"==typeof a){if(this.debug&&this.console.log("Deval.parse call for id: "+a),a=document.getElementById(a),void 0!=a&&!a)return this.console.error("Deval.parse says:\n\nElement id not found: "+a),!1;b=!0}a||(a=document.body);for(var c=b?[a]:a.children,d=0;d<c.length;d++){var e=c[d].getAttribute("id");(!e||e&&!this._data[e])&&void 0==c[d].getAttribute(this._attrs.ignore)&&this.parseChild(c[d])&&this.parse(c[d])}return!0},Deval.prototype.parseChild=function(a){if(!a)return!1;var b=a.getAttribute("id");if(b&&this._data[b])return this.debug&&this.console.log("Already parsing: "+b),!1;var c={eval:a.getAttribute(this._attrs.eval),loop:a.getAttribute(this._attrs.loop),form:a.getAttribute(this._attrs.form),value:a.getAttribute(this._attrs.value)};if(c.eval||c.loop){this._depth++,c.row=a.getAttribute(this._attrs.row),c.ajax=a.getAttribute(this._attrs.ajax),c.params=a.getAttribute(this._attrs.params),c.interval=a.getAttribute(this._attrs.interval),c.limit=a.getAttribute(this._attrs.limit),c.event=a.getAttribute(this._attrs.event),c.translate=a.getAttribute(this._attrs.translate),c.validate=a.getAttribute(this._attrs.validate),c.callback=a.getAttribute(this._attrs.callback),c.error=a.getAttribute(this._attrs.error),c.debug=a.getAttribute(this._attrs.debug),b||(this._dynIDNum++,b=this._dynID+this._dynIDNum,a.setAttribute("id",b)),c.id=b,_computedStyle=getElementStyle(a,"display"),c.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:"";var d={eval:c.eval,loop:c.loop},e=!1;for(var f in d){var g=d[f];if(g){c.type=f,c.get="",c.set="";var h=g.split("=");if(void 0==h[1]?c.get=g.trim():(c.set=h.shift().trim(),c.get=h.join("=").trim()),"="==c.get[0]&&(c.set+="=",c.get=c.get.substring(1)),e="eval"!=c.type||this.parseEvalAndLoop(c,a,g),e&&(e=this.render(c),!c.form&&!c.value))return e}}}return void 0!=c.form?(this._depth++,c.type="form",c.debug=a.getAttribute(this._attrs.debug),c.params=a.getAttribute(this._attrs.params),c.translate=a.getAttribute(this._attrs.translate),c.validate=a.getAttribute(this._attrs.validate),c.callback=a.getAttribute(this._attrs.callback),c.error=a.getAttribute(this._attrs.error),b||(this._dynIDNum++,b=this._dynID+this._dynIDNum,a.setAttribute("id",b)),c.id=b,_computedStyle=getElementStyle(a,"display"),c.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:"",this.formParse(c)):void 0!=c.value&&(this._depth++,c.debug=a.getAttribute(this._attrs.debug),b||(this._dynIDNum++,b=this._dynID+this._dynIDNum,a.setAttribute("id",b)),c.id=b,_computedStyle=getElementStyle(a,"display"),c.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:"",this.formParseChild(a)),!0},Deval.prototype.parseEvalAndLoop=function(_o,_e,_attr){var _debugmsg="";(this.debug||_o.debug)&&(_debugmsg="Found data-"+_o.type+'="'+_attr+'"');var _operators=new Array("==","!==","=","!","<",">");if(!_o.set||_operators.indexOf(_o.set.slice(-1))==-1&&_operators.indexOf(_o.get[0])==-1){if(!_o.set&&_o.get)try{if(eval("_o.dat = "+_o.get+" ? true : false"),(this.debug||_o.debug)&&this.console.log(_debugmsg+" #2 set/get eval returned: "+_o.dat+(_o.dat?"":" (display:none, ignore)")),_e.style.display=_o.dat?_o.display:"none",!_o.dat)return this._templates[_o.id]||(this._templates[_o.id]=_e.innerHTML),_e.innerHTML="",!1;this._templates[_o.id]&&(_e.innerHTML=this._templates[_o.id])}catch(a){return this.console.error("Deval.parseEvalAndLoop straight if eval says: \n\n"+a+"\n\ndata-"+_o.type+'="'+_attr+'"'),!1}else if(_o.set&&"this."==_o.set.substring(0,5))try{_attr=_attr.replace("this.","_e."),eval(_attr),(this.debug||_o.debug)&&this.console.log(_debugmsg+" #3 dom ref (this) eval ok: "+_attr)}catch(a){return this.console.error("Deval.parseEvalAndLoop this match eval says: \n\n"+a+"\n\ndata-"+_o.type+'="'+_attr+'"'),!1}}else try{if(eval("_o.dat = "+_attr),(this.debug||_o.debug)&&this.console.log(_debugmsg+" #1 comparison eval returned: "+_o.dat+(_o.dat?"":" (display:none, ignore)")),_e.style.display=_o.dat?_o.display:"none",!_o.dat)return this._templates[_o.id]||(this._templates[_o.id]=_e.innerHTML),_e.innerHTML="",!1;this._templates[_o.id]&&(_e.innerHTML=this._templates[_o.id])}catch(a){return this.console.error("Deval.parseEvalAndLoop eval says: \n\n"+a+"\n\ndata-"+_o.type+'="'+_attr+'"'),!1}return!0},Deval.prototype.render=function(_o){var _e;if("string"==typeof _o)return _e=document.getElementById(_o),_e?this.parseChild(_e):(this.console.error("Deval.render says:\n\nUnknown id: \n\n"+_o),!1);var _err="";if(!_o.id||void 0==_o.set||void 0==_o.dat&&!_o.get&&!_o.url&&"form"!=_o.type){try{_err=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.render says:\n\nInsufficent params!\n\n"+_err),!1}if(_e=document.getElementById(_o.id),!_e){try{_err=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.render says:\n\nElement id not found: "+_o.id+"\n\n"+_err),!1}if(this._objects[_o.id]&&this._objects[_o.id].template&&(_o.template=this._objects[_o.id].template,_o.display=this._objects[_o.id].display?this._objects[_o.id].display:""),void 0==_o.display&&(_computedStyle=getElementStyle(_e,"display"),_o.display=_computedStyle&&"none"!=_computedStyle.toLowerCase()?_computedStyle:""),_o.type=_o.type?_o.type:"eval",!_o.updateCallback&&this._objects[_o.id]&&this._objects[_o.id].updateCallback&&(_o.updateCallback=this._objects[_o.id].updateCallback),(this.debug||_o.debug)&&(this.console.log("---------------------------------------------------------------"),this.console.log("Parsing "+_o.type+": "+(_o.set?_o.set+"=":"")+(_o.get?_o.get:_o.url?_o.url:_o.dat?_o.dat:"")+(_o.interval?" (interval: "+_o.interval+")":""))),_o.dom=_e,void 0==_o.dat){var _ajaxGetCall=!(!_o.get||"ajax:"!=_o.get.substring(0,5));if(_o.url||_ajaxGetCall){if(_ajaxGetCall){var _ajaxParams=_o.get.split(":");if(_ajaxParams.shift(),_o.ajax=!0,_o.params=_o.params?_o.params:_o.dom.getAttribute(this._attrs.params),!_o.translate&&_ajaxParams[1]){var _trans=_ajaxParams[0];switch(_trans){case"json":case"xml":case"tags":_ajaxParams.shift(),_o.translate=_trans}}_o.url=_ajaxParams.join(":")}return _o.get="",this._objects[_o.id]=_o,_o.parser=this,this.ajaxCall(_o),!1}if(void 0==_o.dat&&_o.get)try{if(_o.set?eval("_o.dat = "+_o.set+"="+_o.get):eval("_o.dat = "+_o.get),_e.style.display=_o.dat?_o.display:"none",!_o.dat)return _e.innerHTML="",!1}catch(a){var err="";try{delete _o.dom,err=JSON.stringify(_o)}catch(a){}return(this.debug||_o.debug)&&this.console.error("Deval.render get/set eval says: \n\n"+a+"\n\n"+err),!1}}else if(_o.set&&_o.dat)try{eval(_o.set+"=_o.dat")}catch(a){var erri="";try{delete _o.dom,erri=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.render set eval says: \n\n"+a+"\n\n"+erri),!1}if(void 0==_o.dat)return!1;var _debugmsg="";(this.debug||_o.debug)&&(_debugmsg="Rendering "+_o.type+": "+(_o.set?_o.set+"=":"")+_o.get+" ("+(_o.dat?typeof _o.dat:_o.get)+") ("+_o.id+")");var _template=_o.template?_o.template:_o.dom.innerHTML;switch(_o.template||(_o.template=_template),this._objects[_o.id]||(this._objects[_o.id]=_o),_o.type){default:(this.debug||_o.debug)&&this.console.log(_debugmsg);break;case"eval":(this.debug||_o.debug)&&this.console.log(_debugmsg),_o.template=this.renderType(_o),_o.dom.innerHTML=_o.template,_o.template=_template,_o.dom.children[0]&&(_o.set&&eval(_o.set+"=_o.dat"),this.parse(_o.dom));break;case"loop":var _loopedTemplate="",_count=0,_start=0,_length=_o.dat.length,_limitcall=_o.limit;if(_o.limit)if(parseInt(_o.limit)==_o.limit)_o.limit=parseInt(_o.limit);else if(_o.limit.match(",")){var _tmp=_o.limit.split(",");if(_tmp[1])try{eval("_start = "+_tmp[0]),eval("_o.limit = "+_tmp[1]),_start=parseInt(_start),_o.limit=parseInt(_o.limit)}catch(a){return this.console.error("Deval.render limit eval says: "+a+" (fix your limit methods/variables!)"),!1}}else try{eval("_o.limit = "+_o.limit),_o.limit=parseInt(_o.limit)}catch(a){return this.console.error("Deval.render limit eval says: "+a+" (fix your limit method/variable!)"),!1}(this.debug||_o.debug)&&_o.limit&&this.console.log("Limiting rendering loop with: "+(_start?_start+", "+_o.limit:_o.limit)+" ("+this._attrs.limit+'="'+_limitcall+'")');var _i,_olength;if(void 0==_length){_length=Object.keys(_o.dat).length,(this.debug||_o.debug)&&this.console.log(_debugmsg+"("+_length+")");for(_i in _o.dat){if(_o.limit&&_count>=_o.limit)break;if(_count>=_start){if(_o.row){(this.debug||_o.debug)&&this.console.log("Formatting loop row: "+_o.set+"["+_i+"]="+_o.row+"("+_o.set+"["+_i+"])");try{eval("_o.dat[_i]="+_o.row+"(_o.dat[_i])")}catch(a){return this.console.error("Deval.render loop row says: \n\n"+a+" with "+_o.row),!1}}_olength=_o.dat[_i]?_o.dat[_i].length:0,void 0==_olength&&"object"==typeof _o.dat[_i]&&(_olength=Object.keys(_o.dat[_i]).length),_o.template=_template,_o.template=_o.template.replace(new RegExp("\\["+_o.set+".key\\(\\)\\]","g"),_i),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".num\\(\\)\\]","g"),_count+1),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".count\\(\\)\\]","g"),_olength),_o.dom.innerHTML=this.renderChild(_o,_i),_o.dom.children[0]&&(_o.set&&eval(_o.set+"=_o.dat[_i]"),this.parse(_o.dom)),_loopedTemplate+=_o.dom.innerHTML}_count++}}else for((this.debug||_o.debug)&&this.console.log(_debugmsg+"("+_length+")"),_i=_start;_i<_length&&!(_o.limit&&_count>=_o.limit);_i++){if(_count>=_start){if(_o.row){(this.debug||_o.debug)&&this.console.log("Formatting loop row: "+_o.set+"["+_i+"]="+_o.row+"("+_o.set+"["+_i+"])");try{eval("_o.dat[_i]="+_o.row+"(_o.dat[_i])")}catch(a){return this.console.error("Deval.render loop row says: \n\n"+a+" with "+_o.row),!1}}_olength=_o.dat[_i]?_o.dat[_i].length:0,void 0==_olength&&"object"==typeof _o.dat[_i]&&(_olength=Object.keys(_o.dat[_i]).length),_o.template=_template,_o.template=_o.template.replace(new RegExp("\\["+_o.set+".key\\(\\)\\]","g"),_i),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".num\\(\\)\\]","g"),_count+1),_o.template=_o.template.replace(new RegExp("\\["+_o.set+".count\\(\\)\\]","g"),_olength),_o.dom.innerHTML=this.renderChild(_o,_i),_o.dom.children[0]&&(_o.set&&eval(_o.set+"=_o.dat[_i]"),this.parse(_o.dom)),_loopedTemplate+=_o.dom.innerHTML}_count++}_o.dom.innerHTML=_loopedTemplate,_o.template=_template}if(this._data[_o.id]=!1,_o.interval&&(!_o.ajax||_o.ajax&&_o.dat)&&(delete _o.dom,delete _o.dat,delete _o.parser,setTimeout("deval.render("+JSON.stringify(_o)+");",parseInt(_o.interval))),_o.event)try{this.addEventListener(_o.event,_o.id)}catch(a){this.console.error("Deval.render event says: "+a)}if(_e.style.display="",_o.callback&&_o.dat)switch(delete _o.dom,delete _o.parser,typeof _o.callback){case"string":try{(this.debug||_o.debug)&&this.console.log("Callback: "+_o.callback+" (id:"+_o.id+")"),eval(_o.callback+"(_o)")}catch(a){this.console.error("Deval.render callback says: "+a)}break;default:(this.debug||_o.debug)&&this.console.log("Callback: function (id:"+_o.id+")"),_o.callback(_o)}if(_o.updateCallback)switch(delete _o.dom,delete _o.parser,typeof _o.updateCallback){case"string":try{eval(_o.updateCallback+"(_o)")}catch(a){this.console.error("Deval.render update-callback says: "+a)}break;default:_o.updateCallback(_o)}return!1},Deval.prototype.addEventListener=function(a,b){return this._events[a]&&this._events[a][b]?this._events[a][b]:(this.debug&&this.console.log('Listening on event "'+a+'" for id: '+b),window.addEventListener(a,function(a){this.debug&&this.console.log("dispatchEvent: "+a.detail),this.update(a.detail)}.bind(this)),this._events[a]||(this._events[a]={}),this._events[a][b]=new CustomEvent(a,{detail:b}),this._events[a][b])},Deval.prototype.removeEventListener=function(a,b){if(!this._events[a]||!this._events[a][b])return!0;if(this.debug&&(b?this.console.log('Removing listener "'+a+'" for id: '+b):this.console.log('Removing listener "'+a)),!b){for(var c in this.events[a])window.removeEventListener(a,this.events[a][b]);return!0}return window.removeEventListener(a,this._events[a][b])},Deval.prototype.dispatchEvent=function(a,b){if(!this._events[a]||b&&!this._events[a][b])return this.console.error('Deval.js dispatchEvent says: Unknown event "'+a+'", use Deval.addEventListener to create it.');try{if(this.debug&&(b?this.console.log('Event "'+a+'" for id: '+b):this.console.log('Event "'+a)),b)return window.dispatchEvent(this._events[a][b]);for(var c in this._events[a])window.dispatchEvent(this._events[a][c]);return!0}catch(a){this.console.error("Deval.js dispatchEvent says: "+a)}},Deval.prototype.event=function(a,b){return this._events[a]?this.dispatchEvent(a):this.addEventListener(a,b)},Deval.prototype.renderChild=function(a,b){return this.renderType({dom:a.dom,id:a.id,set:a.set,get:a.get,dat:a.dat[b],url:a.url,callback:a.callback,template:a.template,limit:a.limit,display:a.display,debug:a.debug})},Deval.prototype.renderType=function(a){switch(a.dat.constructor){case Object:case Array:a=this.renderSingle(a),a=this.renderMulti(a);break;default:a=this.renderSingle(a)}return a.template},Deval.prototype.renderSingle=function(a){if(!a.set)return a;try{var b=a.template.replace(new RegExp("\\["+a.set+"\\]","g"),a.dat);a.template=b}catch(b){var c="";try{delete a.dom,c=JSON.stringify(a)}catch(a){}return this.console.error("Deval.render get says:\n\n"+b+"\n\n"+c),a}return a},Deval.prototype.renderMulti=function(_o){if(!_o.set)return _o.dom.style.display=_o.dat?_o.display:"none",_o;var _tmplate=_o.template;_brackets=_tmplate.match(new RegExp("\\[[^"+_o.set+".]([^.].*?)\\]","g"));var _i;if(_brackets)for(_i=0;_i<_brackets.length;_i++)_tmplate=_tmplate.replace(_brackets[_i],_brackets[_i].replace(new RegExp("\\]","g"),"%!}"));if(_brackets=_tmplate.match(new RegExp("\\[("+_o.set+".[^.].*?)\\]","g")),!_brackets)return _o;var _template=_o.template;for(_i=0;_i<_brackets.length;_i++){_brackets[_i]=_brackets[_i].replace(new RegExp("%!}","g"),"]");var _match=_brackets[_i].substring(1,_brackets[_i].length-1);try{eval(_o.set+"=_o.dat")}catch(a){var _err="";try{delete _o.dom,_err=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.render dat eval says:\n\n"+a+"\n\n"+_err),_o}var _replace="";try{eval("_replace ="+_match)}catch(a){(this.debug||_o.debug)&&this.console.error("Deval.render array/object says:\n\n"+a+"\n\n"+_brackets[_i]+"\n\n"),_replace=""}void 0==_replace&&(_replace=""),_template=_template.replace(new RegExp(_brackets[_i].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),_replace)}return _o.template=_template,_o},Deval.prototype.update=function(_id,_updateCallback){if(!this._objects[_id]){var _e=document.getElementById(_id);return _e?this.parseChild(_e):(this.console.error("Deval.update id not found:\n\n"+_id),!1)}delete this._objects[_id].dom,delete this._objects[_id].dat,delete this._objects[_id].parser,this._data[_id]=!1,_updateCallback&&(this._objects[_id].updateCallback=_updateCallback),this.debug&&this.console.log("Deval.update call for id: "+_id),eval("deval.render("+JSON.stringify(this._objects[_id])+");")},Deval.prototype.store=function(a){return!this._data[a]&&(this._data[a]=!0,!0)},Deval.prototype.ajaxCall=function(_o,_data){var self=this;_o.ajaxCall=function(_ref){var _ajaxRequest;try{_ajaxRequest=new XMLHttpRequest}catch(a){try{_ajaxRequest=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{_ajaxRequest=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return _ref.ajax="error",_ref.parser&&_ref.parser.ajaxParse(_ref),self.onError(),self.console.error("Deval.ajaxCall says:\n\nNo Ajax support in your browser?"),!1}}}_ajaxRequest.onerror=function(a){self.onError(),_ref.ajax="error",_ref.parser&&_ref.parser.ajaxParse(_ref,"Could not access the URL")},_ajaxRequest.onreadystatechange=function(){4==_ajaxRequest.readyState&&(200==_ajaxRequest.status||304==_ajaxRequest.status?(_ref.dat=_ajaxRequest.responseText,_ref.ajax="ok",_ref.parser&&_ref.parser.ajaxParse(_ref)):_ajaxRequest.status&&(self.onError(),_ref.ajax="error",_ref.parser&&_ref.parser.ajaxParse(_ref,"URL response status was: "+_ajaxRequest.status)))};var _url=_ref.url;if(_ref.params){var _check=void 0,_urlParamsValidated=[];if(_ref.params.indexOf("=")===-1)try{switch(eval("_check = "+_ref.params),_check.constructor){case Array:for(var _a=0;_a<_check.length;_a++)_check.constructor===Array&&_check.constructor===Object||_urlParamsValidated.push(_a+"="+_check[_a]);break;case Object:for(var _b in _check)_check.constructor===Array&&_check.constructor===Object||_urlParamsValidated.push(_b+"="+_check[_b]);break;default:_urlParamsValidated.push(_check)}}catch(a){self.debug&&self.console.log(_ref.params+": "+a),_check=void 0}if(void 0==_check)for(var _params=_ref.params.split("&"),_i=0;_i<_params.length;_i++){var _vals=_params[_i].split("=");if(_vals[1])try{eval("_check = "+_vals[1])}catch(a){self.console.error("Deval.ajaxCall data-params:\n\n"+a)}if(void 0!=_check)switch(_check.constructor){case Array:for(var _c=0;_c<_check.length;_c++)_urlParamsValidated.push(_vals[0]+"["+_c+"]="+_check[_c]);break;case Object:for(var _d in _check)_urlParamsValidated.push(_vals[0]+"["+_d+"]="+_check[_d]);break;default:_urlParamsValidated.push(_vals[0]+"="+_check)}else _urlParamsValidated.push(_vals[0])}_urlParamsValidated=_urlParamsValidated.join("&"),_url+=_ref.url.indexOf("?")==-1?"?":"&",_url+=_urlParamsValidated}_data?("get"===_ref.method.toLowerCase()&&(_url=_url+"?"+_data),_ajaxRequest.open(_ref.method?_ref.method:"POST",_url,!0),_ref.enctype||(_ref.enctype="application/x-www-form-urlencoded"),_ajaxRequest.setRequestHeader("Content-type",_ref.enctype),_ajaxRequest.send(_data)):(_ajaxRequest.open(_ref.method?_ref.method:"GET",_url,!0),_ajaxRequest.send(null)),_ref.ajax="loading",_ref.parser&&_ref.parser.ajaxParse(_ref)},self.ajaxState(1),_o.ajax="init",_o.ajaxCall(_o,_data)},Deval.prototype.ajaxState=function(a){this._ajaxLoading+=a,!this._ajaxLoading&&this.onAjax?this.onAjax():this.onLoad&&this.onLoad()},Deval.prototype.ajaxParse=function(_o,_errormsg){var init=!1,error=!1,loading=!1,ok=!1;switch(_o.ajax){case"init":init=!0;break;case"error":this.ajaxState(-1),error=!0;break;case"loading":loading=!0;break;case"ok":if(ok=!0,this.ajaxState(-1),_o.ajaxSuccess=!0,_o.dat&&_o.translate)switch(_o.translate){case"json":try{_o.dat=JSON.parse(_o.dat)}catch(a){var _err="";try{delete _o.dom,delete _o.parser,_err=JSON.stringify(_o)}catch(a){}this.console.error("Deval.ajaxParse JSON.parse says:\n\n"+a+"\n\n"+_err),error=!0}break;case"xml":try{if(window.DOMParser){var _parser=new DOMParser;_o.dat=_parser.parseFromString(_o.dat,"text/xml")}else{var _xmlDoc=new ActiveXObject("Microsoft.XMLDOM");_xmlDoc.async=!1,_xmlDoc.loadXML(_o.dat),_o.dat=_xmlDoc}}catch(a){var _erri="";try{delete _o.dom,delete _o.parser,_erri=JSON.stringify(_o)}catch(a){}this.console.error("Deval.ajaxParse XML parser says:\n\n"+a+"\n\n"+_erri),error=!0}break;case"tags":_o.dat=_o.dat.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");break;default:switch(typeof _o.translate){case"string":try{eval("_o.dat = "+_o.translate+"(_o.dat);"),(_o.parser&&_o.parser.debug||_o.debug)&&this.console.log("Deval.ajaxParse says:\n\nTranslation ok: "+_o.translate)}catch(a){this.console.error("Deval.ajaxParse says:\n\nTranslation error with: "+_o.translate+"\n\n"+a)}break;default:_o.dat=_o.translate(_o.dat)}}}if("form"==_o.type)return error&&this.console.error(_errormsg),_o.errormsg=_errormsg,this.formParse(_o);var _e=_o.dom?_o.dom:document.getElementById(_o.id);if(!_e){var _erra="";try{delete _o.dom,delete _o.parser,_erra=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.ajaxParse says:\n\nElement id not found: "+_o.id+"\n\n"+_erra),!1}var _computedStyle=getElementStyle(_e,"display");"none"==_computedStyle&&(_e.style.display="");for(var _children=_e.getElementsByTagName("*"),_i=0;_i<_children.length;_i++)if(_children[_i]){var _attr=_children[_i].getAttribute(this._attrs.ajax);if(_attr){var _check=!1;try{eval("_check = "+_attr)}catch(a){var _errb="";try{delete _o.dom,delete _o.parser,_errb=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.ajaxParse data-ajax says:\n\n"+a+"\n\n"+_errb),!1}_children[_i].style.display=_check||"ok"==_attr&&_o.ajaxSuccess?_o.display:"none"}}ok?((_o.parser&&_o.parser.debug||_o.debug)&&this.console.log("Ajax finished: "+_o.url+" (id:"+_o.id+")"),this.render(_o),this.onComplete&&setTimeout(this.onComplete(_o.id),1)):error?((_o.parser&&_o.parser.debug||_o.debug)&&this.console.error("Ajax ERROR "+_o.id+": \n\n"+(_errormsg?_errormsg+"\n\n":"")+"data-"+_o.type+'="'+_o.set+" = "+_o.url+'"'),_o.interval&&(delete _o.dom,delete _o.dat,setTimeout("deval.render("+JSON.stringify(_o)+");",parseInt(_o.interval)))):(_o.parser&&_o.parser.debug||_o.debug)&&this.console.log("Ajax "+(_o.method?_o.method:"GET")+": data-"+_o.type+'="'+_o.set+" = "+_o.url+'" (id:'+_o.id+")"),this._data[_o.id]=!1},Deval.prototype.formParse=function(_o){var _e=document.getElementById(_o.id);if(!_e){var _err="",_id=_o.id;try{delete _o.dom,delete _o.parser,delete _o.id,_err=JSON.stringify(_o)}catch(a){_err+="\n\n"+a}return this.console.error("Deval.formParse says:\n\nElement id not found: "+_id+"\n\n"+_err),!1}_o.ajax||(_o.ajax="init");var init="init"==_o.ajax,error="error"==_o.ajax,loading="loading"==_o.ajax,ok="ok"==_o.ajax;if(void 0==_o.display){var _computedStyle=getElementStyle(_e,"display");"none"==_computedStyle&&(_e.style.display="")}_o.action=_e.action,_o.method=_e.method,this._formSubmits[_o.id]||(_o.template=_e.innerHTML,this._formSubmits[_o.id]=_o),_e.onsubmit||(_e.onsubmit=function(a){return deval.formSubmit(this,a)});for(var _children=_e.getElementsByTagName("*"),_attr,_i=0;_i<_children.length;_i++)if(_children[_i])if(_attr=_e.getAttribute(this._attrs.ajax)){var _check=!1;try{eval("_check = "+_attr)}catch(a){var _errd="";try{delete _o.dom,delete _o.parser,_errd=JSON.stringify(_o)}catch(a){}return this.console.error("Deval.formParse data-ajax says:\n\n"+a+"\n\n"+_errd),!1}_e.style.display=_check?_o.display:"none"}else if(init&&_o.validate&&!_e.notyetvalidated)switch(_e.notyetvalidated=!0,_e.type){default:_e.addEventListener("keyup",function(){try{eval('deval.formChange("'+_o.id+'", "'+_o.validate+'")')}catch(a){this.console.error("Error! data-validate says:\n\n"+a)}});break;case"radio":case"checkbox":case"select-one":case"select-multiple":_e.addEventListener("change",function(){try{eval('deval.formChange("'+_o.id+'", "'+_o.validate+'")')}catch(a){this.console.error("Error! data-validate says:\n\n"+a)}})}ok&&_o.dat?(_o.callback=_e.getAttribute(this._attrs.callback),this.formCallback(_o)):_o.errormsg&&(_o.callback=_e.getAttribute(this._attrs.callback),this.formCallback(_o),_o.errormsg="")},Deval.prototype.formCallback=function(_o){if(_o.callback)switch(typeof _o.callback){case"string":try{eval(_o.callback+"(_o.dat, _o.errormsg)")}catch(a){this.console.log("FormParse callback(string) error with: "+_o.formCallback+"\n\n"+a)}break;case"function":try{_o.callback(_o.dat,_o.errormsg)}catch(a){this.console.log("FormParse callback error with: "+_o.callback+"(data)\n\n"+a)}}if(_o.formCallback)switch(typeof _o.formCallback){case"string":try{eval(_o.formCallback+"(_o.dat, _o.errormsg)")}catch(a){this.console.log("FormParse formCallback(string) error with: "+_o.formCallback+"\n\n"+a)}break;case"function":try{_o.formCallback(_o.dat,_o.errormsg)}catch(a){this.console.log("FormParse formCallback error with: "+_o.formCallback+"(data)\n\n"+a)}}},Deval.prototype.formParseChild=function(_e){var _attr=_e.getAttribute("name"),_stored=void 0;this.urlParamsToForm&&(_stored=url[_attr]);var _tmp,c;if(void 0==_stored){var _defaultValue=_e.getAttribute(this._attrs.value);if(void 0!=_defaultValue&&_defaultValue)try{eval("_stored = "+_defaultValue)}catch(a){this.console.error("Error! data-value says:\n\n"+a)}}if(void 0!=_stored)switch(_e.type){case"radio":case"checkbox":_e.checked=!1,_stored&&(_stored="false"!=_stored&&_stored!==!1&&""!==_stored,_stored&&(_e.checked=!0));break;case"select-one":for(_c=0;_c<_e.options.length;_c++)_e.options[_c].selected=!1,_e.options[_c].value==_stored&&(_e.options[_c].selected=!0);break;case"select-multiple":for(_c=0;_c<_e.options.length;_c++)if(_e.options[_c].selected=!1,_tmp=_stored,"string"==typeof _stored&&_stored.match(",")&&(_tmp=_stored.split(",")),_tmp.constructor===Object||_tmp.constructor===Array)for(var _d=0;_d<_tmp.length;_d++)_tmp[_d]==_e.options[_c].value&&(_e.options[_c].selected=!0);else _tmp==_e.options[_c].value&&(_e.options[_c].selected=!0);break;default:_e.value=_stored}return!0},Deval.prototype.formChange=function(_formid,_method){var _e=document.getElementById(_formid);if(!_e)return this.console.error("Deval.formChange says:\n\nElement id not found: "+_formid),!1;var _data=this.formValues(_e,!0);if(void 0!=_data)try{return eval("var _check="+_method+"(_data)"),_check}catch(a){this.console.error('Deval.formChange data-change="'+_method+'" eval says:\n\nError calling: '+_method+"(data)\n\n"+a)}},Deval.prototype.formSubmit=function(_e,_formCallback){var _o=this._formSubmits[_e.getAttribute("id")];if(_o.validate){var checkIfBoolean=null;try{eval('checkIfBoolean = deval.formChange("'+_o.id+'", "'+_o.validate+'")')}catch(a){this.console.error('Deval.formSubmit data-validate="'+_o.validate+'" eval says:\n\nError calling: '+_o.validate+"(data)\n\n"+a)}if(checkIfBoolean===!1)return checkIfBoolean}if(_o.formCallback=_formCallback,_o.method=_o.method?_o.method:"post",_o.action)try{_o.url=_o.action;var _data=this.formValues(_e);if(_o.parser=this,_o.ajax="loading",this.formParse(_o),_o.translate=_o.translate?_o.translate:_e.getAttribute(this._attrs.translate),_e.getAttribute("target"))return _formCallback&&(delete _o.dom,delete _o.parser,setTimeout(_formCallback(JSON.stringify(_o)),200)),!0;this.debug&&this.console.log("Deval.formSubmit ajaxCall "+_o.method+" "+_o.action),this.ajaxCall(_o,_data)}catch(a){var _err="";try{delete _o.dom,delete _o.parser,_err=JSON.stringify(_o)}catch(a){}this.console.error("Deval.formSubmit ajax "+_o.method+" says:\n\n"+a+"\n\n"+_err),_o.ajax="error",this.formParse(_o)}return!1},Deval.prototype.formValues=function(a,b){var c=a.getElementsByTagName("*"),d=a.getAttribute("id"),e=a.getAttribute("enctype");if(FormData&&"multipart/form-data"==e){var f=new FormData(a);return f}_formData=null;for(var g=[],h={},i=0;i<c.length;i++)if(c[i]){var j=c[i].getAttribute("name");if(j){var k,l;switch(c[i].type){case"radio":case"checkbox":l=!c[i].value||c[i].value,l=c[i].checked?l:"",b?h[j]=l:_formData?_formData.append(j,l):g.push(j+"="+l);break;case"select-one":case"select-multiple":for(k=0;k<c[i].options.length;k++)c[i].options[k].selected&&(l=c[i].options[k].value,b?h[j]=l:_formData?_formData.append(j,l):g.push(j+"="+l));break;case"file":for(k=0;k<c[i].files.length;k++)if(c[i].files[k].name)if(b)h[j]=c[i].files[k].name;else{if(!_formData){var m=d+"ajax_iframe",n=document.getElementById(m);if(!n){var o=document.createElement("iframe");o.name=m,o.setAttribute("id",m),a.setAttribute("target",m)}throw new TypeError("Your browser does not support AJAX file uploading.")}_formData.append(j,c[i].files[k])}break;default:l=c[i].value,b?h[j]=l:_formData?_formData.append(j,l):g.push(j+"="+l)}}}return b?h:_formData?_formData:g.join("&")},Deval.prototype.formStorage=function(a){var b="";switch(a.type){case"radio":case"checkbox":b=sessionStorage[a.name]=a.checked?a.value:"";break;case"select-one":b=sessionStorage[a.name]=a.value;break;case"select-multiple":for(var c=[],d=0;d<a.options.length;d++)a.options[d].selected&&c.push(a.options[d].value);b=sessionStorage[a.name]=c;break;default:b=sessionStorage[a.name]=a.value}if(this._storage[a.name]=b,this.debug&&this.console.log(a.name+": "+b),this.onStorage)try{this.onStorage(this._storage)}catch(a){return this.console.error("Deval.formStorage callback says:\n\n"+a+"\n\n"+this.onStorage),!1}},Deval.prototype.clearStorage=function(){for(var a in this._storage)this.debug&&this.console.log("Deleted: "+a+" = "+this._storage[a]),delete sessionStorage[a];if(this._storage={},this.debug&&this.console.log("Storage cleared."),this.onStorage)try{this.onStorage(this._storage)}catch(a){return this.console.error("Deval.formStorage callback says:\n\n"+a+"\n\n"+this.onStorage),!1}},UrlParser.prototype.getUrlParams=function(a){var b=/(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g,c={},d=function(a){return decodeURIComponent(a.replace(/\+/g," "))};for("undefined"==typeof a&&(a=document.location.href);c=b.exec(a);)this[d(c[1])]?"object"!=typeof params[d(c[1])]?this[d(c[1])]=new Array(this[d(c[1])],d(c[2])):this[d(c[1])].push(d(c[2])):this[d(c[1])]=d(c[2])},UrlParser.prototype.parsePathParams=function(a){for(var b=a.split("/"),c=b.length,d=0;d<c;d++)b[d]&&(d==c-1&&(this._parent=this._last?this._last:""),1==d&&(this._first=b[d]),this._last=this[d]=b[d])},UrlParser.prototype.parseHashParams=function(a){var b=a.replace("#","");if(b){var c=b.split("&");for(var d in c){var e=c[d].split("=");this._hash[e[0]]=e[1]}}},"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),!Element.prototype.addEventListener){var oListeners={};Element.prototype.addEventListener=function(a,b){if(oListeners.hasOwnProperty(a)){for(var c=oListeners[a],d=-1,e=0;e<c.aEls.length;e++)if(c.aEls[e]===this){d=e;break}if(d===-1)c.aEls.push(this),c.aEvts.push([b]),this["on"+a]=runListeners;else{var f=c.aEvts[d];this["on"+a]!==runListeners&&(f.splice(0),this["on"+a]=runListeners);for(var g=0;g<f.length;g++)if(f[g]===b)return;f.push(b)}}else oListeners[a]={aEls:[this],aEvts:[[b]]},this["on"+a]=runListeners},Element.prototype.removeEventListener=function(a,b){if(oListeners.hasOwnProperty(a)){for(var c=oListeners[a],d=-1,e=0;e<c.aEls.length;e++)if(c.aEls[e]===this){d=e;break}if(d!==-1)for(var f=0,g=c.aEvts[d];f<g.length;f++)g[f]===b&&g.splice(f,1)}}}!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),
c}return"function"!=typeof window.CustomEvent&&(a.prototype=window.Event.prototype,void(window.CustomEvent=a))}(),console||(console={log:function(a){},error:function(a){}});var url=new UrlParser,deval=new Deval;